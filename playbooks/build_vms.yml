---
- name: Build all vms
  hosts: all
  gather_facts: no
  
  vars_files:
    - ../vars/vars.yml

  tasks:
    - name: get existings vms
      community.libvirt.virt:
        command: list_vms
      register: existing_vms
      changed_when: false

    - name: build vm
      ansible.builtin.include_tasks: "../tasks/build_vms_{{ vm.type }}.inc.yml"
      loop: "{{ vms }}"
      loop_control:
        loop_var: vm

    - name: build hds
      ansible.builtin.include_tasks: ../tasks/build_hds.inc.yml
      loop: "{{ vms }}"
      loop_control:
        loop_var: vm
